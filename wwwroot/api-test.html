<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HavenCNC API Test Interface</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007acc;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #555;
            border-left: 4px solid #007acc;
            padding-left: 15px;
            margin-top: 30px;
        }
        .api-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007acc;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover {
            background: #005999;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .results {
            margin-top: 15px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            display: none;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .links {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .links a {
            color: #007acc;
            text-decoration: none;
            padding: 8px 12px;
            border: 1px solid #007acc;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .links a:hover {
            background: #007acc;
            color: white;
        }
        .coordinate-input {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .coordinate-input input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß HavenCNC Server - Machine Control API Test Interface</h1>
        
        <p>This interface allows you to test all the CNC machine control endpoints. The server implements the complete IMachineInterface API with over 80 endpoints covering movement, spindle control, tool management, IO operations, and more.</p>
        
        <div class="links">
            <a href="/swagger" target="_blank">üìö API Documentation (Swagger)</a>
            <a href="/swagger/v1/swagger.json" target="_blank">üìÑ OpenAPI Specification</a>
            <a href="/" target="_blank">üè† React App</a>
        </div>

        <div class="api-section">
            <h2>üéÆ System Control</h2>
            <div class="button-grid">
                <button onclick="callAPI('/api/machine/EnterFullScreen', 'POST')">Enter Full Screen</button>
                <button onclick="callAPI('/api/machine/ExitFullScreen', 'POST')">Exit Full Screen</button>
                <button class="danger" onclick="callAPI('/api/machine/Shutdown', 'POST')">Shutdown System</button>
                <button onclick="callAPI('/api/machine/RestartCentroid', 'POST')">Restart Centroid</button>
            </div>
        </div>

        <div class="api-section">
            <h2>üè† Machine Control</h2>
            <div class="button-grid">
                <button class="success" onclick="callAPI('/api/machineextended/HomeMachine', 'POST')">Home Machine</button>
                <button onclick="callAPI('/api/machineextended/UnhomeMachine', 'POST')">Unhome Machine</button>
                <button class="danger" onclick="callAPI('/api/machineextended/EmergencyStop', 'POST')">Emergency Stop</button>
                <button onclick="callAPI('/api/machineextended/ResetMachine', 'POST')">Reset Machine</button>
            </div>
        </div>

        <div class="api-section">
            <h2>üìç Movement Control</h2>
            <div>
                <h4>Move to Coordinates:</h4>
                <div class="coordinate-input">
                    <input type="number" id="moveX" placeholder="X" value="0" step="0.001">
                    <input type="number" id="moveY" placeholder="Y" value="0" step="0.001">
                    <input type="number" id="moveZ" placeholder="Z" value="0" step="0.001">
                    <input type="number" id="moveA" placeholder="A" value="0" step="0.001">
                </div>
                <button onclick="moveToCoordinates()">Move To Position</button>
                <button onclick="callAPI('/api/machine/GetCurrentPosition', 'GET')">Get Current Position</button>
            </div>
        </div>

        <div class="api-section">
            <h2>‚ö° Spindle Control</h2>
            <div class="button-grid">
                <button class="success" onclick="startSpindle()">Start Spindle (1000 RPM)</button>
                <button class="danger" onclick="callAPI('/api/machine/StopSpindle', 'POST')">Stop Spindle</button>
                <button onclick="callAPI('/api/machine/GetSpindleSpeed', 'GET')">Get Spindle Speed</button>
                <button onclick="callAPI('/api/machine/WarmUpSpindle', 'POST')">Warm Up Spindle</button>
            </div>
        </div>

        <div class="api-section">
            <h2>üîß Tool Management</h2>
            <div class="button-grid">
                <button onclick="callAPI('/api/machineextended/ChangeToTool/1', 'POST')">Change to Tool #1</button>
                <button onclick="callAPI('/api/machineextended/ChangeToTool/2', 'POST')">Change to Tool #2</button>
                <button onclick="callAPI('/api/machineextended/GetCurrentToolNumber', 'GET')">Get Current Tool</button>
                <button onclick="callAPI('/api/machineextended/MeasureCurrentTool', 'POST')">Measure Current Tool</button>
            </div>
        </div>

        <div class="api-section">
            <h2>üìü IO Control</h2>
            <div class="button-grid">
                <button onclick="callAPI('/api/machineextended/GetCurrentInputs', 'GET')">Get All Inputs</button>
                <button onclick="callAPI('/api/machineextended/GetCurrentOutputs', 'GET')">Get All Outputs</button>
                <button onclick="callAPI('/api/machineio/StartVacuum', 'POST')">Start Vacuum</button>
                <button onclick="callAPI('/api/machineio/StopVacuum', 'POST')">Stop Vacuum</button>
            </div>
        </div>

        <div id="results" class="results">
            <h4>API Response:</h4>
            <pre id="responseData"></pre>
        </div>
    </div>

    <script>
        // Set the base URL dynamically
        const baseUrl = window.location.origin;

        // Generic API call function
        async function callAPI(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (body !== null) {
                    if (typeof body === 'string') {
                        options.body = JSON.stringify(body);
                    } else {
                        options.body = JSON.stringify(body);
                    }
                }

                const response = await fetch(baseUrl + endpoint, options);
                const data = await response.json();
                
                showResults({
                    endpoint: endpoint,
                    method: method,
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                });
            } catch (error) {
                showResults({
                    endpoint: endpoint,
                    method: method,
                    error: error.message
                });
            }
        }

        function showResults(result) {
            const resultsDiv = document.getElementById('results');
            const responseData = document.getElementById('responseData');
            
            responseData.textContent = JSON.stringify(result, null, 2);
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Specialized functions
        function moveToCoordinates() {
            const x = parseFloat(document.getElementById('moveX').value) || 0;
            const y = parseFloat(document.getElementById('moveY').value) || 0;
            const z = parseFloat(document.getElementById('moveZ').value) || 0;
            const a = parseFloat(document.getElementById('moveA').value) || 0;
            
            const moveRequest = {
                point: { x, y, z, a },
                xySpeed: 100,
                zSpeed: 50
            };
            
            callAPI('/api/machine/MoveTo', 'POST', moveRequest);
        }

        function startSpindle() {
            callAPI('/api/machine/StartSpindle', 'POST', 1000);
        }
    </script>
</body>
</html>
